package com.example.mdd_

import android.content.Intent
import androidx.appcompat.app.AppCompatActivity
import android.os.Bundle
import android.os.Looper
import android.view.Gravity
import android.view.View
import android.widget.EditText
import android.widget.Toast
import androidx.appcompat.app.AlertDialog
import org.json.JSONObject
import java.security.SecureRandom
import java.security.cert.X509Certificate
import javax.net.ssl.SSLContext
import javax.net.ssl.TrustManager
import javax.net.ssl.X509TrustManager

class PassActivity : AppCompatActivity() {

    var flag = 0

    override fun onCreate(savedInstanceState: Bundle?) {
        super.onCreate(savedInstanceState)
        setContentView(R.layout.activity_pass)
    }

    fun sendPass(view: View) {

        Thread {
            var s = "" //debugging

            try {
                if(findViewById<EditText>(R.id.pass1).text.toString() != findViewById<EditText>(R.id.pass2).text.toString()) {

                    flag = 1
                    run {
                        Looper.prepare()
                        showSetAlert()
                        Looper.loop()
                    }
                }

                /*else if(findViewById<EditText>(R.id.pass1).text.toString() == "") {

                    flag = 2
                    run {
                        Looper.prepare()
                        showSetAlert()
                        Looper.loop()
                    }
                }

                else if(findViewById<EditText>(R.id.pass1).text.toString().length < 4){
                    flag = 0
                    run {
                        Looper.prepare()
                        showSetAlert()
                        Looper.loop()
                    }
                }*/

                //at this point, password is ready to be sent
                else {
                    val editText = findViewById<EditText>(R.id.pass1)
                    val message = editText.text.toString()

                    // POST password
                    val json = JSONObject()
                    json.put("password", message)
                    val challengeResp = Helper.sendPostRequest("password", json.toString())


                    if(challengeResp.substring(0, 16) != "{\n   \"challenge\""){
                        val index1 = challengeResp.indexOf("{\n   \"") + 6
                        val index2 = challengeResp.indexOf("\": ")
                        val title = challengeResp.substring(index1, index2)
                        val msg = challengeResp.substring(index2 + 4, s.length - 4)

                        run {
                            Looper.prepare()
                            showAlert(title, msg)
                            Looper.loop()
          